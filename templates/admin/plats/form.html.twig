{# templates/admin/plats/form.html.twig #}

<div class="plat-form-container">
    <div class="commande-actions">
        <button class="ajax-btn btn-back" data-url="{{ path('admin_plats_list') }}">
            <img src="{{ asset('Visuels/Icônes/Back_Beige.png') }}"> Retour à la liste
        </button>
    </div>

    <h1>{{ plat is defined ? 'Modifier le plat' }}</h1>

    {# Flash messages #}
    {% for label, messages in app.flashes %}
        {% for message in messages %}
            <div class="flash-message flash-{{ label }}">
                {{ message }}
            </div>
        {% endfor %}
    {% endfor %}

    {{ form_start(form, {
        'attr': { 'class': 'ajax-plat-form' }, 
        'enctype': 'multipart/form-data',
        'action': path('admin_plats_edit', { 'id': plat.id }),
        'method': 'POST'
    }) }}

        <div class="form-group">
            {{ form_label(form.titrePlat) }}
            {{ form_widget(form.titrePlat, { 'attr': {'class': 'form-input'} }) }}
            {{ form_errors(form.titrePlat) }}
        </div>

        <div class="form-group">
            {{ form_label(form.category) }}
            {{ form_widget(form.category, { 'attr': {'class': 'form-select'} }) }}
            {{ form_errors(form.category) }}
        </div>

        <div class="form-group">
            {{ form_label(form.description) }}
            {{ form_widget(form.description, { 'attr': {'class': 'form-textarea'} }) }}
            {{ form_errors(form.description) }}
        </div>

        <div class="form-group">
            {{ form_label(form.image) }}
            {{ form_widget(form.image, { 'attr': {'class': 'form-input'} }) }}
            {{ form_errors(form.image) }}

            {# Affiche l'image actuelle si elle existe (mode édition) #}
            {% if plat is defined and plat.image %}
                <p>Image actuelle :</p>
                <img src="{{ asset(plat.image) }}" alt="{{ plat.altTexte }}" class="image-plat-preview">
            {% endif %}
        </div>

        <div class="form-group">
            {{ form_label(form.altTexte) }}
            {{ form_widget(form.altTexte, { 'attr': {'class': 'form-input'} }) }}
            {{ form_errors(form.altTexte) }}
        </div>

        <div class="form-group">
            <label class="form-title">Allergènes</label>

            <div class="allergenes-list">
                {% for allergeneField in form.allergenes %}
                    <div class="allergene-item">
                        {{ form_widget(allergeneField) }}
                        {{ form_label(allergeneField) }}
                    </div>
                {% endfor %}
            </div>

            {{ form_errors(form.allergenes) }}
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-submit">
                <img src="{{ asset('Visuels/Icônes/Select_Beige.png') }}" alt="">
                Sauvegarder le plat
            </button>
        </div>

    {{ form_end(form) }}
</div>